The program Calcualte_lake_inflow.f90 can take output from both the WATFLOOD and Standalone MESH model and outputs a file you can use to calculate the amount of inflow into a lake.  It uses a file containing grided outflow (which is actually streamflow) created by each model and creates a *.csv file for a series of grids.  If these grids are the ones that inflow into a lake then you can sum the columns together in the *.csv file and that will be the inflow into the lake.  This is the way the program was set up, but of course you can have whichever grids you wanted in the input file.

For both models the input file is called "glake_inflow.csv".  This is a three column file with the identifier of the lake in the first column and then the east-west coordinate of the grid in column 2 and the north-south coordinate in column 3.  You can use the program lake_inflow_streamflow_files.f90 to create the glake_inflow.csv file from the basin's *.map file (although this program was obviously designed for the Great Lakes it should work for any watershed).

To use the output from each model you have to change the hardcoded WATFLOOD flag to true or false.

For WATFLOOD:

- run WATFLOOD (or WATFLOOD in WATROUTE mode) with the ensim flag to "y" for all events

- make sure that WFO_SPEC.txt file only outputs (ie. has a 1) for  "Grid Outflow"

- this will create a watflood.wfo file in the results directory

- create a new file called watflood_mod.wfo by deleting the ascii header information (couldn't get the program to skip over it).

- now run "Calcualte_lake_inflow.f90"

- 2 files will be created - inflow_daily.csv and inflow_monthly.csv

For Standalone MESH:

- had to add the following to the standalone MESH code:

Near the top:

OPEN(unit=72,file="./" // GENDIR_OUT(1:INDEX(GENDIR_OUT," ")-1) // &
                  '/basin_streamflow_hourly.csv')


After the call to WF_ROUTE:

! Write out streamflow for each grid point
  DO K = 1, ycount
    DO J = 1, xcount
      WF_QSYN_GRID(J,K)= -1.00
    END DO
  END DO

  DO I = 1, NA
     WF_QSYN_GRID(YYY(I),XXX(I))=WF_QSYN(I)
  END DO

  DO K = ycount, 1 , -1
     WRITE( 72, '(F10.3, 999(",", F10.3) )' ) (WF_QSYN_GRID(K,J),J=1, xcount)
  END DO
  WRITE( 72, * )

And where all the files are closed at the end just to keep it neat:

CLOSE(UNIT=72)


- run standalone MESH

- get the basin_streamflow_daily.csv file

- now run "Calcualte_lake_inflow.f90"

- 2 files will be created - inflow_daily.csv and inflow_monthly.csv



